# 所有点评接口

​		实习来第一个有难度的需求。

背景：部门点评只向外暴露可展示点评（审核通过且三年以内），因为线上点评只查es（es不能再添加不展示数据，因为所有点评量接近亿级别），有实验需要查询所有点评（审核未通过、三年之前）。

​		分布式锁：使用redis的lua脚本实现的可重入分布式锁，有自动释放锁时间，若业务未完成需要自动续锁（时间可配置）。

---

​		为了避免大量无点评或者无追评的订单id请求打到db上，需要再加一层缓存订单id是否有点评和追评，因为没有追评显然没有主点评很显然想到了布隆过滤器。布隆过滤器的错判只会出线把不存在的判定为存在，概率很小，并且不能删除元素的缺点在此处也不存在，因为点评本就不能删除，只是三年后的数据会放到归档表里不向外展示。所以对错判率的要求也不是很高，相比redis的bitmap占用内存就更小了。

# guava的布隆过滤器

